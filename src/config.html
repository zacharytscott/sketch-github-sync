<h1>GitHub CSS Sync</h1>
<label for="token">GitHub token:</label>
<input id="token" type="text" />
<label for="url">Repo URL:</label>
<input id="url" type="text" />

<button id="save" onClick="save()" disabled>Save</button>

<p id="error-message"></p>

<script>
    const tokenEl = document.getElementById('token');
    const urlEl = document.getElementById('url');
    const buttonEl = document.getElementById('save');
    const errorMessageEl = document.getElementById('error-message');

    let validationTimeoutId;

    window.setSettings = function(settings) {
        tokenEl.value = settings.token;
        urlEl.value = settings.repoUrl;
    };

    window.settingsValidated = function(results) {
        if (results.ok) {
            errorMessageEl.innerText = "You're good to go!";

            buttonEl.removeAttribute('disabled');
        } else {
            errorMessageEl.innerText = results.errorMessage;

            buttonEl.setAttribute('disabled', 'disabled');
        }
    }

    function getTokenAndRepoUrl() {
        return {
            token: tokenEl.value,
            repoUrl: urlEl.value
        };
    }

    function save() {
        window.postMessage('settingsSaved', getTokenAndRepoUrl());
    }

    urlEl.addEventListener('input', event => {
        window.clearTimeout(validationTimeoutId);

        validationTimeoutId = window.setTimeout(() => {
                errorMessageEl.innerText = 'loading';
                window.postMessage('validationRequested', getTokenAndRepoUrl());
            }, 1000);
    });
</script>

<style >
    body {
        color: white;
        font-family: sans-serif;
        display: flex;
        margin: 10% 30%;
        flex-direction: column;
    }

    h1 {
        font-size: 40px;
        font-family: Noteworthy;
        text-align: center;
    }

    label {
        margin-top: 5px;
    }
</style>